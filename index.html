<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Study Assistant — Full</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Inter', sans-serif; background: #eef1f7; padding: 20px; }
  .container { max-width: 1000px; margin: auto; background: white; padding: 24px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.08); }
  h1 { font-size: 28px; margin: 0 0 6px 0; }
  .muted { color: #6b7280; margin-bottom: 12px; }
  textarea, input[type=text], select {
    width: 100%; padding: 12px; margin-top: 6px; border-radius: 8px; border: 1px solid #e6eef9; font-size: 15px; background: #fbfdff;
  }
  .row { display:flex; gap:10px; align-items:center; }
  button { padding: 10px 14px; border-radius: 8px; border: 0; cursor:pointer; font-weight:600; }
  .primary { background:#2563eb; color:white; }
  .secondary { background:#eef2ff; color:#08306b; }
  pre { background:#f8fafc; padding:16px; border-radius:8px; white-space:pre-wrap; max-height:480px; overflow:auto; margin-top:12px; }
  .input-mode { margin-bottom:12px; }
</style>
</head>
<body>
  <div class="container">
    <h1>AI Study Assistant</h1>
    <div class="muted">Upload PDF/DOCX/IMG, paste URL or text → choose task → Generate</div>

    <div class="input-mode">
      <label><input type="radio" name="mode" value="text" checked> Text</label>
      <label style="margin-left:12px"><input type="radio" name="mode" value="file"> File</label>
      <label style="margin-left:12px"><input type="radio" name="mode" value="url"> URL</label>
    </div>

    <div id="textBox"><textarea id="textInput" rows="6" placeholder="Paste or type text..."></textarea></div>
    <div id="fileBox" style="display:none"><input id="fileInput" type="file" /></div>
    <div id="urlBox" style="display:none"><input id="urlInput" type="text" placeholder="https://..." /></div>

    <div style="margin-top:12px">
      <label>Task</label>
      <select id="taskSelect">
        <option value="summary">Summary</option>
        <option value="mindmap">Mindmap</option>
        <option value="bullet">Bullet points</option>
        <option value="flashcards">Flashcards</option>
      </select>
    </div>

    <div class="row" style="margin-top:12px">
      <button class="primary" onclick="submitProcess()">Generate</button>
      <button class="secondary" onclick="clearAll()">Clear</button>
      <div id="loading" style="margin-left:12px; color:#2563eb; display:none">Processing…</div>
    </div>

    <pre id="outputArea"></pre>
  </div>

<script>
document.querySelectorAll('input[name="mode"]').forEach(r=>{
  r.addEventListener('change', ()=>{
    const v = document.querySelector('input[name="mode"]:checked').value;
    document.getElementById('textBox').style.display = v==='text' ? 'block' : 'none';
    document.getElementById('fileBox').style.display = v==='file' ? 'block' : 'none';
    document.getElementById('urlBox').style.display = v==='url' ? 'block' : 'none';
  });
});

async function submitProcess(){
  const mode = document.querySelector('input[name="mode"]:checked').value;
  const task = document.getElementById('taskSelect').value;
  const out = document.getElementById('outputArea');
  const loading = document.getElementById('loading');
  out.innerText = ''; loading.style.display = 'inline';

  const form = new FormData();
  form.append('task', task);

  if(mode === 'text'){
    const t = document.getElementById('textInput').value.trim();
    if(!t){ alert('Please enter text'); loading.style.display='none'; return; }
    form.append('text', t);
  } else if(mode === 'file'){
    const f = document.getElementById('fileInput').files[0];
    if(!f){ alert('Please choose a file'); loading.style.display='none'; return; }
    form.append('file', f);
  } else {
    const u = document.getElementById('urlInput').value.trim();
    if(!u){ alert('Please enter URL'); loading.style.display='none'; return; }
    form.append('url', u);
  }

  try {
    const resp = await fetch('/api/process', { method: 'POST', body: form });
    if(!resp.ok){ const e = await resp.json().catch(()=>null); throw new Error(e?.error || 'Server error'); }
    const j = await resp.json();
    out.innerText = j.output || JSON.stringify(j, null, 2);
  } catch (err) {
    alert('Error: ' + (err.message || err));
  } finally {
    loading.style.display = 'none';
  }
}

function clearAll(){
  document.getElementById('textInput').value=''; document.getElementById('fileInput').value=null; document.getElementById('urlInput').value=''; document.getElementById('outputArea').innerText='';
}
</script>
</body>
</html>
